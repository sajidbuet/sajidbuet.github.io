{{ $item := .item }}
{{ $has_attachments := partial "functions/has_attachments" $item }}

<!-- Extract publication category from folder name -->
{{ $segments := split (trim $item.RelPermalink "/") "/" }}
{{ $code := replaceRE "[-]" "" (index $segments 1) }}
{{ $publicationnum := print "[" (upper (substr $code 0 1)) (substr $code 1) "]" }}
{{ $category := upper (substr $code 0 1) }} <!-- Extract first letter as category -->

<div class="pub-list-item view-citation" data-category="{{ $category }}" style="margin-bottom: 1rem">
  <div class="w-16 text-left pr-4 font-bold text-lg text-gray-700">
    {{ $publicationnum }}
  </div>
  <div class="flex-1">
    <i class="far fa-file-alt pub-icon" aria-hidden="true"></i>

    {{ if eq (site.Params.publications.citation_style | default "apa") "apa" }}
    <span class="article-metadata li-cite-author">
      {{ partial "page_metadata_authors" $item }}
    </span>
    ({{- $item.Date.Format "2006" -}}).
    <a href="{{ $item.RelPermalink }}" class="underline">{{ $item.Title }}</a>.
    {{ if $item.Params.publication_short }}
      {{- $item.Params.publication_short | markdownify -}}.
    {{ else if $item.Params.publication }}
      {{- $item.Params.publication | markdownify -}}.
    {{ end }}

    {{ if $has_attachments }}
    <div class="flex flex-wrap space-x-3">
      {{ partial "page_links" (dict "page" $item "is_list" 1) }}
    </div>
    {{ end }}

    {{ else }}

    <span class="article-metadata li-cite-author">
      {{ partial "page_metadata_authors" $item }}.
    </span>
    <a href="{{ $item.RelPermalink }}">  {{ $item.Title }}</a>.
    {{ if $item.Params.publication_short }}
      {{- $item.Params.publication_short | markdownify -}}.
    {{ else if $item.Params.publication }}
      {{- $item.Params.publication | markdownify -}}.
    {{ end }}
    {{- $item.Date.Format "2006" -}}.

    {{ if $has_attachments }}
    <div class="flex flex-wrap space-x-3">
      {{ partial "page_links" (dict "page" $item "is_list" 1) }}
    </div>
    {{ end }}

    {{ end }}
  </div>
</div>
